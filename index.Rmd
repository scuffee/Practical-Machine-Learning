---
title: "Practical-Machine-Learning"
author: "Sandra Cuffee"
date: "December 7, 2017"
output: html_document
toc: true
toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
### Note:
## devtools::install_github('topepo/caret/pkg/caret') ,  required for parallel processing of data files.


## **Data Files**

The data files were retrieved from: http://web.archive.org/web/20161224072740/http:/groupware.les.inf.puc-rio.br/har

```{r, echo = FALSE}
download.file("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv",destfile="pml-training.csv",method="libcurl")

download.file("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv",destfile="pml-testing.csv",method="libcurl")
```

## **Data Frames**

Two data frames were created in order to explore, run tests, and generate graphs pertaining to the data sets.  The training data frame was used to create the training and vlaidation data sets.  The testing data frame was used for the test set. 


```{r, echo= FALSE}

training<-(read.csv("pml-training.csv",header=TRUE,sep=","))
testing<-(read.csv("pml-testing.csv",header=TRUE, sep=","))
```

## **Information About the Training and Test Data**

"Six young health participants were asked to perform one set of 10 repetitions of the Unilateral Dumbbell Biceps Curl in five different fashions: exactly according to the specification (Class A), throwing the elbows to the front (Class B), lifting the dumbbell only halfway (Class C), lowering the dumbbell only halfway (Class D) and throwing the hips to the front (Class E)."

### Number of Observations,Variables, and NAs
```{r,library(dplyr),library(utils),echo =FALSE}
library(dplyr);library(utils);library(caret);library(doParallel)
library(parallel);library(utils);library(ggplot2)
dim(training);dim(testing) #A count of observations and variables
glimpse(training) #print variable names and types
sum(is.na(training));sum(is.na(testing))#check for missing data

```
###  Cleaning the Training and Validation Data 

Both data frames were reviewed in table format using the fix method to help determine what data would be useful for testing the training and validation data.  The glimpse function was used to verify the predictor variables under test.  No changes were made to the test data.

```{r, echo=FALSE}
nv<-nearZeroVar(training,saveMetrics=TRUE,names = TRUE) # ID Predictors to Remove
training=training[,c(-6,-12:-17,-20,-26,-51:-59,-69:-75,-78,-79,-81,-82,-87:-92,-95,-98,-101,-125:-131,-133,-134,-139,-142:-150)]
##fix(training)
training = training[,c(-11:-25)]
##fix(training)
training = training[,c(-1:-5,-11, -12, -26,-36:-39,-43:-48,-50:-59,-72:-76,-78)]
##fix(training)
sum(is.na(training));glimpse(training);dim(training)


glimpse(testing);dim(testing);sum(is.na(testing))
sum(is.na(testing));glimpse(testing);dim(testing) 

```

## **Random Forest Test on Training Set**

Random forest tests were conducted using the caret function for accuracy and parallel processing was used to reduce the run time of the tests on the training and validation data sets. The mtry equal to 27 provided the best results for training and validation data sets.  The training data set  had a 99.68% accuracy and the smaller validation data set had a 98.75% accuracy.

```{r, library(caret), library(doParallel), library(parallel),echo=FALSE}
set.seed(95014)

 inTraining <- createDataPartition(training$classe, p = .75, list=FALSE)
 trainingTrain <- training[inTraining,]
 testingTrain <- training[-inTraining,]
 y <- trainingTrain[,54]
 x <- trainingTrain[,-54]
 cluster <- makeCluster(detectCores() - 1)
 registerDoParallel(cluster)
 fitControl <- trainControl(method = "cv",number = 5,allowParallel = TRUE)
 fit <- train(x,y, method="rf",data=trainingTrain,trControl = fitControl)
 stopCluster(cluster)
 registerDoSEQ()
 fit
```

###  Random Forest Test on Validation Set

```{r, echo = FALSE}

set.seed(95014)

 inTraining <- createDataPartition(training$classe, p = .75, list=FALSE)
 trainingTrain <- training[inTraining,]
 testingTrain <- training[-inTraining,]
 y <- testingTrain[,54]
 x <- testingTrain[,-54]
 cluster <- makeCluster(detectCores() - 1)
 registerDoParallel(cluster)
 fitControl2 <- trainControl(method = "cv",number = 5,allowParallel = TRUE)
 fit2 <- train(x,y, method="rf",data=training,trControl = fitControl2)
 stopCluster(cluster)
 registerDoSEQ()
 fit2
```

### Random Forest Test on Test Set

The caret predict function was used on the test data set.

```{r, echo=FALSE}
testSet<-predict(fit,testing)

```

 ## **Predictions**

Statistical analysis was completed for both the training and validation sets.

```{r,library(caret), echo=FALSE}
fit
fit$resample
confusionMatrix.train(fit)
fit$finalModel
trainingFit<-(fit$finalModel)
print(trainingFit)

fit2
fit2$resample
confusionMatrix(fit2)
fit2$finalModel
validationFit<-fit2$finalModel
print(validationFit)

print(testSet)

```

## **Plots**

###Training Prediction Plot
```{r, library(ggplot2), echo=FALSE}


plot(fit)
```

### Validation Prediction Plot

```{r, echo = FALSE}
plot(fit2)
```

###Test Predicition Plot

```{r, echo=FALSE}
plot(testSet)
```
## **Appendix**

### References 

gh-page setup

https://github.com/lgreski/datasciencectacontent/blob/master/markdown/pml-ghPagesSetup.md

Improving Peformance of Random Forest in caret::train()

https://github.com/lgreski/datasciencectacontent/blob/master/markdown/pml-randomForestPerformance.md


Weight Lifting Exercises Dataset

Velloso, E.; Bulling, A.; Gellersen, H.; Ugulino, W.; Fuks, H. Qualitative Activity Recognition of Weight Lifting Exercises. Proceedings of 4th International Conference in Cooperation with SIGCHI (Augmented Human '13) . Stuttgart, Germany: ACM SIGCHI, 2013

. 
